{"version":3,"file":"index.js","sources":["../src/events.ts","../src/array-map.ts","../src/index.ts"],"sourcesContent":["type ExpandableElement = HTMLElement & { [key: string]: any };\ntype DelegatedEventHandler = (e: Event, model?: any) => any;\n\nconst eventRegistry = new Set();\n\nfunction lookup(\n  el: ExpandableElement,\n  name: string\n): [DelegatedEventHandler, any?] {\n  let h = el[name],\n    m = el.model,\n    r,\n    p;\n  if (\n    (h === undefined || (h.length > 1 && m === undefined)) &&\n    (p = el.host || el.parentNode)\n  )\n    r = lookup(p, name);\n  return [h !== undefined ? h : r && r[0], m || (r && r[1])];\n}\nfunction eventHandler(e: Event) {\n  const node = (e.composedPath && e.composedPath()[0]) || e.target;\n  const [handler, model] = lookup(node as ExpandableElement, `__${e.type}`);\n\n  // reverse Shadow DOM retargetting\n  if (e.target !== node) {\n    Object.defineProperty(e, \"target\", {\n      configurable: true,\n      value: node\n    });\n  }\n  return handler && handler(e, model);\n}\n\nexport const delegateEvents = (eventNames: string[]) => {\n  for (let i = 0, l = eventNames.length; i < l; i++) {\n    const name = eventNames[i];\n    if (!eventRegistry.has(name)) {\n      eventRegistry.add(name);\n      document.addEventListener(name, eventHandler);\n    }\n  }\n};\n","import { FidanArray, arrayMap } from \"@fidanjs/runtime\";\n\nexport const jsxArrayMap = <T>(\n  arr: FidanArray<T[]>,\n  renderCallback: (data: T) => DocumentFragment,\n  renderMode?: \"reuse\" | \"reconcile\"\n) => {\n  return parentElement => {\n    arrayMap(arr, parentElement, undefined, renderCallback, renderMode);\n  };\n};\n","import {\n  compute,\n  FidanValue,\n  arrayMap as fidanArrayMap\n} from \"@fidanjs/runtime\";\n\nexport * from \"./events\";\nexport * from \"./array-map\";\n\nexport const arrayMap = (\n  parent: Node & ParentNode,\n  arr: FidanValue<any[]>,\n  renderCallback?: (item: any, idx?: number) => any,\n  marker?: Element\n) => {\n  fidanArrayMap(arr, parent, marker, renderCallback, \"reconcile\");\n};\n\nexport const insert = (\n  parent: Node,\n  accessor: any,\n  init?: any,\n  marker?: Node\n) => {\n  if (typeof accessor === \"object\") {\n    parent.insertBefore(accessor, marker);\n  } else if (typeof accessor === \"function\") {\n    const node = document.createTextNode(\"\");\n    if (accessor.hasOwnProperty(\"$val\")) {\n      compute(() => {\n        node.data = accessor();\n        if (!node.parentNode) {\n          parent.insertBefore(node, marker);\n        }\n      });\n    } else {\n      node.data = accessor();\n      parent.insertBefore(node, marker);\n    }\n  } else {\n    const node = document.createTextNode(accessor);\n    parent.insertBefore(node, marker);\n  }\n};\n\nexport const spread = (node: HTMLElement, accessor: any) => {\n  if (typeof accessor === \"function\") {\n    accessor(node);\n  } else {\n    if (accessor instanceof Node === false)\n      accessor = document.createTextNode(accessor || \"\");\n    node.appendChild(accessor);\n  }\n};\n\nexport const attr = (\n  node: Element,\n  attributeName: string,\n  setAttr: boolean,\n  cmp: any\n) => {\n  if (cmp.hasOwnProperty(\"$val\")) {\n    if (setAttr) {\n      compute(() => node.setAttribute(attributeName, cmp()), [cmp]);\n    } else {\n      compute(() => (node[attributeName] = cmp()), [cmp]);\n    }\n  } else {\n    if (typeof cmp === \"function\") {\n      cmp = cmp(node);\n    }\n    if (setAttr) {\n      node.setAttribute(attributeName, cmp);\n    } else {\n      node[attributeName] = cmp;\n    }\n  }\n};\n\nexport const conditional = (\n  parent: Node & ParentNode,\n  condition: {\n    test: () => boolean | FidanValue<any>;\n    consequent: any;\n    alternate: any;\n  },\n  init?: any,\n  marker?: Node\n) => {\n  let oldElement = null;\n  let lastVal = false;\n  const conditionCompute = condition.test.hasOwnProperty(\"$val\")\n    ? condition.test\n    : compute(condition.test);\n  compute(() => {\n    if (oldElement && parent.childElementCount === 0) {\n      return;\n    }\n    const val = !!conditionCompute();\n    if (val !== lastVal) {\n      if (parent && parent.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n        parent = marker.parentNode;\n      }\n      let newElement = val ? condition.consequent : condition.alternate;\n      if (newElement instanceof Node === false)\n        newElement = document.createTextNode(newElement || \"\");\n      if (oldElement) {\n        parent.replaceChild(newElement, oldElement);\n      } else {\n        parent.insertBefore(newElement, marker);\n      }\n      oldElement = newElement;\n    }\n    lastVal = val;\n  }, [conditionCompute]);\n};\n"],"names":["const","eventRegistry","Set","lookup","el","name","h","m","model","r","p","undefined","length","host","parentNode","eventHandler","e","node","composedPath","target","type","handler","Object","defineProperty","configurable","value","delegateEvents","eventNames","let","i","l","has","add","document","addEventListener","jsxArrayMap","arr","renderCallback","renderMode","parentElement","arrayMap","parent","marker","fidanArrayMap","insert","accessor","init","insertBefore","createTextNode","hasOwnProperty","compute","data","spread","Node","appendChild","attr","attributeName","setAttr","cmp","setAttribute","conditional","condition","oldElement","lastVal","conditionCompute","test","childElementCount","val","nodeType","DOCUMENT_FRAGMENT_NODE","newElement","consequent","alternate","replaceChild"],"mappings":"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"}